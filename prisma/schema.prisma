// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            BigInt        @id
  email         String        @unique
  username      String        @unique
  passHash      String?
  lastRevoke    DateTime?
  refreshTokens String[]
  apps          Application[]
  auths         Auth[]

  // flags
  verified Boolean @default(false)
  admin    Boolean @default(false)
}

model Application {
  id        BigInt     @id
  name      String     @unique
  avatarUrl String?    @map("avatarPath")
  owner     User       @relation(fields: [ownerId], references: [id])
  ownerId   BigInt     @map("userId")
  redirects Redirect[]
  auths     Auth[]

  // flags
  bypassScopes Boolean @default(false)
}

model Redirect {
  id          BigInt       @id
  uri         String
  Application Application? @relation(fields: [appId], references: [id])
  appId       BigInt?      @map("applicationId")

  @@unique([uri, appId])
}

model Auth {
  id          BigInt       @id
  User        User?        @relation(fields: [userId], references: [id])
  userId      BigInt?
  Application Application? @relation(fields: [appId], references: [id])
  appId       BigInt?      @map("applicationId")

  jwtSecret String
}
